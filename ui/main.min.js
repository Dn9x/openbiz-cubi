(function(){"use strict";function t(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function n(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s+".js"))&&n.push(s)}function r(e,t,n){var i;for(i in t)t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)?e[i]=t[i]:typeof t[i]=="object"&&(!e[i]&&t[i]&&(e[i]={}),r(e[i],t[i],n))}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.4",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";l[5]?(c=l[1],f=c+p):(f=i,p=l[4],h=s.locale,h||(h=s.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),d=h.split("-"));if(a.isBuild){v.push(f),n(o,"root",v,c,p);for(g=0;g<d.length;g++)y=d[g],b+=(b?"-":"")+y,n(o,b,v,c,p);o(v,function(){u()})}else o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++)i=d[g],b+=(b?"-":"")+i,t(b,e,n,v,c,p);o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t],i=e[s];if(i===!0||i===1)i=o(c+s+"/"+p);r(m,i)}u(m)})})}}})})(),"use strict",define("nls/locale",{root:{loading:"Loading ...",app:{name:"Openbiz Cubi Platform",description:"A openbiz based application, provides basically user, account, models and permission contronls."},account:{invitationsNewView:{viewTitle:"<span>Create</span> New Account",viewDescription:"Openbiz Cubi Application Platform 4.0",copyright:"&copy; 2014 Openbiz LLC",createAccountButton:"Create Account",alreadyHaveAccount:"Already have an account? ",goToLogin:"Go to Login",title:"Title",titleMr:"Mr.",titleMiss:"Miss",titleMrs:"Mrs",titleMs:"Ms.",name:"Name",firstName:"First Name",lastName:"Last Name",nameFormat:["firstName","lastName"],company:"Company",phone:"Phone",mobile:"Mobile",mobileNumber:"Mobile Number",phoneDefaultCountryCode:"+1",phoneCountryCode:"Country Code",phoneAreaCode:"Area Code",phoneNumber:"Phone Number",email:"Email",password:"Password",passwordPlaceholder:"At leaset 6 charactors",repeatPassword:"Repeat",repeatPasswordPlaceholder:"Repeat password",agreeWith:"I have read and agreed with ",termOfUse:"term of use",signing:"Signing up",validation:{needAgreement:"You need to check this agreement before continue",passwordNotMatch:"The password is not matched",emailDuplicated:"The email address has been registered by other user",emailNotInvitable:"The email address is already assicated with account"}}},user:{loginView:{viewTitle:"<span>Wel</span>come",viewDescription:"Openbiz Cubi Application Platform 4.0",email:"Email",password:"Password",signIn:"Sign In",or:"or",remember:"Remember",forgetPassword:"Forget Password?",createAccount:"Create Account",signing:"Signing in",copyright:"&copy; 2014 Openbiz LLC",validation:{incorrectPassword:"Email or password is incorrect"}},forgetPasswordView:{viewTitle:"<span>Reset</span> Password",viewDescription:"Openbiz Cubi Application Platform 4.0",pleaseInputEmail:"Please fill in yout email address in below field. Our system will send you an email with a link to allow your to reset your password.",email:"Email",sendRequest:"Send Request",or:"or",goToLogin:"Go to Login",copyright:"&copy; 2014 Openbiz LLC"},registerView:{viewTitle:"<span>Create</span> New Account",viewDescription:"Openbiz Cubi Application Platform 4.0",copyright:"&copy; 2014 Openbiz LLC",createAccountButton:"Create Account",alreadyHaveAccount:"Already have an account? ",goToLogin:"Go to Login",title:"Title",titleMr:"Mr.",titleMiss:"Miss",titleMrs:"Mrs",titleMs:"Ms.",name:"Name",firstName:"First Name",lastName:"Last Name",nameFormat:["firstName","lastName"],company:"Company",phone:"Phone",mobile:"Mobile",mobileNumber:"Mobile Number",phoneDefaultCountryCode:"+1",phoneCountryCode:"Country Code",phoneAreaCode:"Area Code",phoneNumber:"Phone Number",email:"Email",password:"Password",passwordPlaceholder:"At leaset 6 charactors",repeatPassword:"Repeat",repeatPasswordPlaceholder:"Repeat password",agreeWith:"I have read and agreed with ",termOfUse:"term of use",signing:"Signing up",validation:{needAgreement:"You need to check this agreement before continue",passwordNotMatch:"The password is not matched",emailDuplicated:"The email address has been registered by other user"}},dashboardView:{}},system:{headerView:{hi:"Hi",help:"Help"},navView:{hi:"Hi"}},me:{setupWizardView:{viewName:"Setup Wizard",viewTitle:"<strong>Account</strong> Setup Wizard",phoneDefaultCountryCode:"+1",phoneCountryCode:"Country Code",phoneAreaCode:"Area Code",phoneNumber:"Phone Number",addressCountry:"Country",addressDefaultCountry:"USA",addressProvince:"Province",addressCity:"City",addressStreet:"Street",addressZipcode:"Zipcode",invitationCodePlaceHolder:"ACCT-XXXX-XXXXXX",validation:{tokenInvalid:"The token code is invalid",companyNotUnique:"The company has been taken"},addUserView:{viewTitle:"<span>Create</span> New Account",viewDescription:"Openbiz Cubi Application Platform 4.0",copyright:"&copy; 2014 Openbiz LLC",createAccountButton:"Create Account",alreadyHaveAccount:"Already have an account? ",goToLogin:"Go to Login",title:"Title",titleMr:"Mr.",titleMiss:"Miss",titleMrs:"Mrs",titleMs:"Ms.",name:"Name",firstName:"First Name",lastName:"Last Name",nameFormat:["firstName","lastName"],company:"Company",phone:"Phone",mobile:"Mobile",mobileNumber:"Mobile Number",phoneDefaultCountryCode:"+1",phoneCountryCode:"Country Code",phoneAreaCode:"Area Code",phoneNumber:"Phone Number",email:"Email",password:"Password",passwordPlaceholder:"At leaset 6 charactors",repeatPassword:"Repeat",repeatPasswordPlaceholder:"Repeat password",agreeWith:"I have read and agreed with ",termOfUse:"term of use",signing:"Signing up",validation:{needAgreement:"You need to check this agreement before continue",passwordNotMatch:"The password is not matched",emailDuplicated:"The email address has been registered by other user",emailNotInvitable:"The email address is already assicated with account"}},userPermissionView:{}}},breadcrumb:{home:"Home",myAccount:"My Account"}},"en-us":!0,"zh-cn":!0}),"use strict",define("modules/system/models/App",[],function(){return Backbone.Model.extend({url:openbiz.apps.cubi.appUrl?openbiz.apps.cubi.appUrl+"/apps":null,idAttribute:"name",defualts:{name:null,roles:[],appUrl:null,baseUrl:null,info:{}},parse:function(e,t){if(e.hasOwnProperty("locale")){e.info.name=e.locale.name,e.info.description=e.locale.description;var n=[];if(e.locale.hasOwnProperty("roles")){for(var r in e.roles){var i=e.roles[r];i.name=e.locale.roles[i.id],n.push(i)}e.roles=n}}return e.hasOwnProperty("require")&&(this.require=e.require),e.hasOwnProperty("menu")&&(this.menu=e.menu),e},constructor:function(){this.url=openbiz.apps.cubi.appUrl+"/apps",Backbone.Model.apply(this,arguments)}})}),"use strict",define("modules/system/models/AppCollection",["./App"],function(e){return Backbone.Collection.extend({model:e,url:openbiz.apps.cubi.appUrl?openbiz.apps.cubi.appUrl+"/apps":null,sync:function(e,t,n){switch(e){case"read":var r=n.success;n.success=function(e,t,n){if(_.isArray(e)&&e.length){var i={},s=0;e.forEach(function(o){var u=require.config({baseUrl:o.baseUrl,context:"appCollection"+o.name,paths:{i18n:openbiz.baseUrl+"/vendor/require/plugins/i18n",text:openbiz.baseUrl+"/vendor/require/plugins/text"},config:{i18n:{locale:"zh-cn"}}});o.require=u,u(["i18n!./nls/locale"],function(a){a.hasOwnProperty("app")&&(o.locale=a.app);var f=function(){i[o.name]=o,s++;if(s==e.length){var u=[];for(var a in e)u[a]=i[e[a].name];r(u,t,n)}};u(["./menu/main"],function(e){o.menu=new e,f()},f)})})}}}Backbone.sync.apply(this,arguments)}})}),define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!templates/system/layoutView.html",[],function(){return'<div id="loading-top"><div id="canvas_loading"></div><span>Checking...</span></div><div id="header"></div><div id="nav"></div><div id="main"></div><nav id="menu"></nav><nav id="contact-right"></nav>'}),"use strict",define("modules/system/views/LayoutView",["text!templates/system/layoutView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"system",name:"layoutView",el:"#wrapper",initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),this.afterViewRenderred(),this},afterViewRenderred:function(){var e=new Throbber({size:32,padding:17,strokewidth:2.8,lines:12,rotationspeed:0,fps:15});e.appendTo(document.getElementById("canvas_loading")),e.start(),$(this.el).find("div#header").hide(),$(this.el).find("div#nav").hide(),$(this.el).find("div#menu").hide()},hideLoading:function(){return $(this.el).find("div#loading-top").hide(),this}})}),define("text!templates/system/contactRightView.html",[],function(){return'<ul><li><span>Friends</span><ul><li class="Label">A</li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/1.jpg"/>Alexa<small>Johnson</small></a></li><li class="img"><a href="#" class="busy"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/2.jpg"/>Alexander<small>Brown</small></a></li><li class="Label">F</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/3.jpg"/>Fred<small>Smith</small></a></li><li class="Label">J</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/4.jpg"/>James<small>Miller</small></a></li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/5.jpg"/>Jefferson<small>Jackson</small></a></li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/6.jpg"/>Jordan<small>Lee</small></a></li><li class="Label">K</li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/7.jpg"/>Kim<small>Adams</small></a></li><li class="Label">M</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/8.jpg"/>Meagan<small>Miller</small></a></li><li class="img"><a href="#" class="busy"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/9.jpg"/>Melissa<small>Johnson</small></a></li><li class="Label">N</li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/10.jpg"/>Nicole<small>Smith</small></a></li><li class="Label">S</li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/1.jpg"/>Samantha<small>Harris</small></a></li><li class="img"><a href="#" class="block"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/2.jpg"/>Scott<small>Thompson</small></a></li></ul></li><li><span>Family</span><ul><li class="Label">A</li><li class="img"><a href="#" class="busy"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/3.jpg"/>Adam<small>White</small></a></li><li class="Label">B</li><li class="img"><a href="#" class="busy"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/4.jpg"/>Ben<small>Robinson</small></a></li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/5.jpg"/>Bruce<small>Lee</small></a></li><li class="Label">E</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/6.jpg"/>Eddie<small>Williams</small></a></li><li class="Label">J</li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/7.jpg"/>Jack<small>Johnson</small></a></li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/8.jpg"/>John<small>Jackman</small></a></li><li class="Label">M</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/9.jpg"/>Martina<small>Thompson</small></a></li><li class="img"><a href="#" class="busy"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/10.jpg"/>Matthew<small>Watson</small></a></li><li class="Label">O</li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/1.jpg"/>Olivia<small>Taylor</small></a></li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/2.jpg"/>Owen<small>Wilson</small></a></li></ul></li><li><span>Work colleagues</span><ul><li class="Label">D</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/3.jpg"/>David<small>Harris</small></a></li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/4.jpg"/>Dennis<small>King</small></a></li><li class="Label">E</li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/5.jpg"/>Eliza<small>Walker</small></a></li><li class="Label">L</li><li class="img"><a href="#" class="busy"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/6.jpg"/>Larry<small>Turner</small></a></li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/7.jpg"/>Lisa<br/><small>Wilson</small></a></li><li class="Label">M</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/8.jpg"/>Michael<small>Jordan</small></a></li><li class="Label">R</li><li class="img"><a href="#"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/9.jpg"/>Rachelle<small>Cooper</small></a></li><li class="img"><a href="#" class="online"><img alt="" src="<%= baseUrl %>/images/photos_preview/50/people/10.jpg"/>Rick<small>James</small></a></li></ul></li></ul>'}),"use strict",define("modules/system/views/ContactRightView",["text!templates/system/contactRightView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"system",name:"contactRightView",el:"#wrapper nav#contact-right",initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),this.app.views.isRenderred("system.ContactRightView")||$(this.el).mmenu({position:"right",counters:!0,searchfield:!0,header:{add:!0,update:!0,title:"Contacts"}},{pageSelector:"div#wrapper"}),openbiz.ui.update($(this.el)),this}})}),define("text!templates/system/menuView.html",[],function(){return'<ul class="system-menu"><li class="app-menu openbiz-cubi"><a href="#!/backend/dashboard"><i class="icon fa fa-laptop"></i>Dashboard</a></li></ul>'}),"use strict",define("modules/system/views/MenuView",["text!templates/system/menuView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"system",name:"menuView",el:"#wrapper nav#menu",initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},loadAppsMenu:function(){this.app.require(["modules/system/models/AppCollection"],function(e){var t=new e;t.fetch({success:function(){for(var e in t.models){var n=t.models[e];n.hasOwnProperty("menu")&&n.menu.render()}}})})},render:function(){return $(this.el).html(this.template(this.app.locale.headerView)),this.app.views.isRenderred("system.MenuView")||($(document).data("menu",$("nav#menu").html()),$("nav#menu").mmenu({searchfield:!0,slidingSubmenus:!0},{pageSelector:"div#wrapper"}).on("closing.mm",function(){function t(){var e=$("nav#menu");e.hasClass("mm-vertical")?e.find("li").each(function(e){$(this).removeClass("mm-opened")}):e.find("ul").each(function(e){e==0?$(this).removeClass("mm-subopened , mm-hidden").addClass("mm-current"):$(this).removeClass("mm-opened , mm-subopened , mm-current  , mm-highest").addClass("mm-hidden")})}var e=$(this).find("ul.mm-highest");e.find(".mm-subclose").trigger("click"),setTimeout(function(){t()},200)}),$("body div.toggle-menu").length==0&&$("body").append('<div class="toggle-menu"/>'),$("body").off("click"),$("body").on("click",".toggle-menu",function(e){e.stopImmediatePropagation(),e.preventDefault(),$("nav#menu").trigger("open.mm")}),this.loadAppsMenu()),openbiz.ui.update($(this.el)),this}})}),define("text!templates/system/navView.html",[],function(){return'<div id="nav-scroll"><div class="avatar-slide"><span data-percent="69" class="avatar-chart"><span class="percent"></span><img alt="" src="<%= baseUrl %>/images/avatar.png" class="circle"/></span><!-- //avatar-chart--><div class="avatar-detail"><p><strong><%= hi %></strong>, <%= me.contact.name.displayName %></p><p><a href="#do-nothing">@ <%= me.contact.company %></a></p><span>12,110 Sales</span><span>106 Follower</span></div><!-- //avatar-detail--><div data-color="theme" class="avatar-link btn-group btn-group-justified"><a href="profile.html" title="Portfolio" class="btn"><i class="fa fa-briefcase"></i></a><a data-toggle="modal" href="#md-notification" title="Notification" class="btn"><i class="fa fa-bell-o"></i><em class="green"></em></a><a data-toggle="modal" href="#md-messages" title="Messages" class="btn"><i class="fa fa-envelope-o"></i><em class="active"></em></a><a href="#contact-right" title="Contact List" class="btn"><i class="fa fa-book"></i></a></div><!-- //avatar-link--></div><!-- //avatar-slide--><div class="widget-collapse dark"><header><a data-toggle="collapse" href="#collapseSummary"><i class="collapse-caret fa fa-angle-up"></i>Summary Order</a></header><section id="collapseSummary" class="collapse in"><div style="padding: 0;" class="collapse-boby"><div class="widget-mini-chart align-xs-left"><div class="pull-right"><div data-type="bar" data-color="theme" data-bar-width="10" data-height="35" class="sparkline mini-chart">2,3,4,5,7,4,5</div></div><p>This week\'s balance</p><h4>$12,788</h4></div><!-- //widget-mini-chart--><div class="widget-mini-chart align-xs-right"><div class="pull-left"><div data-type="bar" data-color="warning" data-bar-width="10" data-height="45" class="sparkline mini-chart">2,3,7,5,4,6,6,3</div></div><p>This week sales</p><h4>1,325 item</h4></div><!-- //widget-mini-chart--></div><!-- //collapse-boby--></section><!-- //collapse--></div><!-- //widget-collapse--><div class="widget-collapse dark"><header><a data-toggle="collapse" href="#collapseTasks"><i class="collapse-caret fa fa-angle-down"></i>(2) Tasks processing</a></header><section id="collapseTasks" class="collapse"><div class="collapse-boby"><div class="widget-slider"><p>Upload status</p><div class="progress progress-dark progress-xs tooltip-in"><div data-color="#FA9E2F" aria-valuetransitiongoal="75" class="progress-bar"></div></div><label class="progress-label">Master.zip 4 / 5 </label><!-- //progress--><div class="progress progress-dark progress-xs"><div data-color="theme-inverse" aria-valuetransitiongoal="45" class="progress-bar"></div></div><label class="progress-label lasted">Profile 2 / 5 </label><!-- //progress--></div><!-- //widget-slider--></div><!-- //collapse-boby--></section><!-- //collapse--></div><!-- //widget-collapse--><div class="widget-collapse dark"><header><a data-toggle="collapse" href="#collapseSetting"><i class="collapse-caret fa fa-angle-up"></i>Setting Option</a></header><section id="collapseSetting" class="collapse in"><div style="padding: 0;" class="collapse-boby"><ul class="widget-slide-setting"><li><div class="ios-switch theme pull-right"><div class="switch"><input type="checkbox" name="option"/></div></div><label>Switch<span>OFF</span></label><small>Lorem ipsum dolor sit amet</small></li><li><div class="ios-switch theme-inverse pull-right"><div class="switch"><input type="checkbox" name="option_1" checked="checked"/></div></div><label>Switch<span>ON</span></label><small>Lorem ipsum dolor sit amet</small></li></ul></div></section></div></div>'}),"use strict",define("modules/system/views/NavView",["text!templates/system/navView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"system",name:"navView",el:"#wrapper div#nav",initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){var e=this;return this.locale.me=openbiz.session.me.toJSON(),$(this.el).html(this.template(this.locale)),$(this.el).fadeIn(function(){var t=document.getElementById("nav");if(t){var n=Hammer(t);n.off("dragright"),n.off("dragleft"),n.on("dragright",function(e){e.gesture.deltaY<=7&&e.gesture.deltaY>=-7&&e.gesture.deltaX>100&&$("nav#menu").trigger("open.mm")}),n.on("dragleft",function(e){e.gesture.deltaY<=5&&e.gesture.deltaY>=-5&&e.gesture.deltaX<-100&&$("nav#contact-right").trigger("open.mm")})}openbiz.ui.update($(e.el))}),this}})}),define("text!templates/system/headerView.html",[],function(){return'<div class="logo-area clearfix"><a href="#do-nothing" class="logo"></a></div><div class="tools-bar"><ul class="nav navbar-nav nav-main-xs"><li><a href="#menu" class="icon-toolsbar"><i class="fa fa-bars"></i></a></li></ul><ul class="nav navbar-nav navbar-right tooltip-area"><li><a href="#contact-right" data-toggle="tooltip" title="Find Contact" data-container="body" data-placement="left"><i class="fa fa-search"></i></a></li><li class="hidden-xs hidden-sm"><a href="#do-nothing" class="h-seperate"><%= help %></a></li><li><a href="#" class="nav-collapse avatar-header"><img alt="" src="<%= baseUrl %>/images/avatar.png" class="circle"/><span class="badge">3</span></a></li><li class="dropdown"><a href="#" data-toggle="dropdown" data-hover="dropdown" class="dropdown-toggle"><em><strong><%= hi %></strong>, <%= me.contact.name.displayName %></em><i class="dropdown-icon fa fa-angle-down"></i></a><ul class="dropdown-menu pull-right icon-right arrow"><li><a href="#do-nothing"><i class="fa fa-user"></i>Profile</a></li><li><a href="#do-nothing"><i class="fa fa-cog"></i>Setting</a></li><li><a href="#do-nothing"><i class="fa fa-bookmark"></i>Bookmarks</a></li><li><a href="#do-nothing"><i class="fa fa-money"></i>Make a Deposit</a></li><li class="divider"></li><li><a href="#!/backend/me/logout" class="btn-logout"><i class="fa fa-sign-out"></i>Signout</a></li></ul><!-- //dropdown-menu--></li><li class="visible-lg"><a href="#" data-toggle="tooltip" title="Full Screen" data-container="body" data-placement="left" class="h-seperate fullscreen"><i class="fa fa-expand"></i></a></li></ul></div>'}),"use strict",define("modules/system/views/HeaderView",["text!templates/system/headerView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"system",name:"headerView",el:"#wrapper #header",events:{"click .fullscreen":"fullscreen","click .nav-collapse":"navcollapse"},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){var e=this;return this.locale.me=openbiz.session.me.toJSON(),$(this.el).html(this.template(this.locale)),openbiz.ui.update($(this.el)),$(this.el).fadeIn(function(){openbiz.ui.update($(e.el))}),this},logout:function(e){e.preventDefault(),Backbone.history.trigger("dismissBackendUI",function(){openbiz.session.me.on("destroy",function(){location.href="#!/user/login"}),openbiz.session.me.destroy()})},navcollapse:function(e){if(this.app.views.isRenderred("system.NavView")==0)return;e.preventDefault();var t=$("#nav,#main");t.toggleClass("nav-collapse-out"),t.hasClass("nav-collapse-out")||t.addClass("none"),setTimeout(function(){t.removeClass("none")},600)},fullscreen:function(e){e.preventDefault(),this._toggleFullScreen(),$(this).find("i").toggleClass("fa-expand"),$(this).find("i").toggleClass("fa-compress")},_toggleFullScreen:function(){document.fullScreenElement&&document.fullScreenElement!==null||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}})}),"use strict",define("modules/me/models/Me",["require"],function(e){return Backbone.Model.extend({url:null,idAttribute:"_id",defualts:{username:null,contact:{},account:{},roles:[]},createAccount:function(e,t){$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:this.url+"/create-account",data:JSON.stringify(e),complete:function(e,n){switch(e.status){case 201:t(!0);break;default:t(!1)}}})},joinAccount:function(e,t){$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:this.url+"/join-account",data:JSON.stringify({token:e}),complete:function(e,n){switch(e.status){case 200:t(!0,e.responseJSON);break;case 403:t(!1);break;default:t(!1)}}})},hasPermission:function(e){for(var t in this.get("roles"))for(var n in this.get("roles")[t])if(this.get("roles")[t][n]===e)return!0;return!1},constructor:function(){this.url=openbiz.apps.cubi.appUrl+"/me",Backbone.Model.apply(this,arguments),this.on("sync",function(e,t,n){openbiz.session.me=e}),this.on("destroy",function(e,t,n){delete openbiz.session.me})}})}),"use strict",define("modules/system/router",["../me/models/Me"],function(e){return openbiz.MiddleWareRouter.extend({app:openbiz.apps.cubi?openbiz.apps.cubi:"cubi",me:null,middlewares:{"!/*any":"renderLayout","!/user/*any":"renderUserUI","!/backend/*ensureLogin":"ensureLogin","!/backend/*any":"renderBackendUI"},initialize:function(){openbiz.MiddleWareRouter.prototype.initialize.call(this),this.me=new e,this.stopListening(Backbone.history),this.listenTo(Backbone.history,"dismissBackendUI",this.dismissBackendUI),this.listenTo(Backbone.history,"dismissUserUI",this.dismissUserUI)},ensureLogin:function(e){openbiz.session.hasOwnProperty("me")&&openbiz.session.me.get("username")!=""?e():this.me.fetch({success:function(){e()},error:function(){Backbone.history.navigate("#!/user/login",{trigger:!0,replace:!0})}})},renderLayout:function(e){var t=this.app.views.get("system.LayoutView");t==null?this.renderView("system.LayoutView",function(){e()}):e()},renderUserUI:function(e){$("#loading-top").show(),$("body").hasClass("full-lg")?($("div#main").hasClass("nav-collapse-out")&&$("div#main").removeClass("nav-collapse-out"),e()):$("div#wrapper").animate({"margin-left":"0px"},function(){$("div#wrapper div#main").animate({"margin-left":"0px"},function(){$("body").addClass("full-lg"),$("div#main").hasClass("nav-collapse-out")&&$("div#main").removeClass("nav-collapse-out"),e()})})},dismissUserUI:function(e){$("#loading-top").hide(),$("body").hasClass("full-lg")?$(window).width()>=550?$("div#wrapper").animate({"margin-left":"50px"},function(){$(window).width()>=991?$("div#wrapper div#main").animate({"margin-left":"250px"},function(){$("body").removeClass("full-lg"),e()}):($("div#wrapper div#main").css("margin-left",""),$("body").removeClass("full-lg"),e())}):($("div#wrapper").css("margin-left",""),$("body").removeClass("full-lg"),e()):e()},renderBackendUI:function(e){$("#loading-top").hide();var t=this,n=function(){var e=function(e){$(e).attr("renderred")!="true"?($(e).attr("renderred","true"),$(e).is(":visible")?t.trigger("headerViewRenderred"):($(e).hide(),$(e).css("top","-"+$(e).height()+"px"),$(e).show(),$(e).animate({top:"0px"},function(){t.trigger("headerViewRenderred")}))):t.trigger("headerViewRenderred")};t.app.views.isRenderred("system.HeaderView")?e(t.app.views.get("system.HeaderView").delegateEvents().$el):t.app.views.render("system.HeaderView",function(t){e(t.$el)})},r=function(){var e=function(e){$(e).attr("renderred")!="true"?($(e).attr("renderred","true"),$(window).width()>=991?($(e).show(),$(e).css("left","0px"),$(e).removeClass("nav-collapse-out"),$("div#main").removeClass("nav-collapse-out"),$("div#wrapper div#main").css("margin-left","0px"),$("div#wrapper div#main").animate({"margin-left":"250px"},function(){$("div#wrapper div#main").css("margin-left",""),$("body").removeClass("full-lg"),$("div#wrapper").css("margin-left",""),t.trigger("navViewRenderred")})):($("div#wrapper div#main").css("margin-left",""),$("div#wrapper").css("margin-left",""),$("body").removeClass("full-lg"),$(e).show(),t.trigger("navViewRenderred"))):($("body").removeClass("full-lg"),t.trigger("navViewRenderred"))};t.app.views.isRenderred("system.NavView")?e(t.app.views.get("system.NavView").delegateEvents().$el):t.app.views.render("system.NavView",function(t){e(t.$el)})},i=function(){var e=function(e){if($(e).attr("renderred")!="true"){$(e).attr("renderred","true");if($(window).width()>=550)$("nav#menu").hide(),$("nav#menu").css("left","0px"),$("nav#menu").show(),$("div#wrapper").animate({"margin-left":"50px"},function(){$("nav#menu").css("display",""),t.trigger("menuViewRenderred")});else{var e=$("nav#menu");$("div#wrapper").css("margin-left",""),$(e).show(),$("nav#menu").css("display",""),t.trigger("menuViewRenderred")}}else t.trigger("menuViewRenderred")};t.app.views.isRenderred("system.MenuView")?e(t.app.views.get("system.MenuView").delegateEvents().$el):t.app.views.render("system.MenuView",function(t){e(t.$el)})},s=function(){var e=function(e){$(e).attr("renderred")!="true"&&($(e).attr("renderred","true"),$("nav#contact-right").show(),$(e).show(),$("nav#contact-right").css("display","")),t.trigger("contactViewRenderred")};t.app.views.isRenderred("system.ContactRightView")?e(t.app.views.get("system.ContactRightView").delegateEvents().$el):t.app.views.render("system.ContactRightView",function(t){e(t.$el)})};t.once("startRenderBackendUI",function(){n()}),t.once("headerViewRenderred",function(){i(),s()}),t.once("menuViewRenderred",function(){r()}),t.once("navViewRenderred",function(){e()}),t.trigger("startRenderBackendUI")},dismissBackendUI:function(e){$("#loading-top").show();var t=this,n=function(){var e=function(e){$(e).attr("renderred","false"),$(e).animate({top:"-"+$(e).height()+"px"},function(){$(e).hide(),t.trigger("headerViewDismissed")})};t.app.views.isRenderred("system.HeaderView")?e(t.app.views.get("system.HeaderView").undelegateEvents().$el):t.trigger("headerViewDismissed")},r=function(){var e=function(e){$(e).attr("renderred","false"),$(e).css("visibility")=="visible"?$("div#wrapper div#main").animate({"margin-left":"0px"},function(){$(e).fadeOut(function(){$(e).removeClass("nav-collapse-out").removeClass("none"),$("#main").removeClass("nav-collapse-out").removeClass("none"),t.trigger("navViewDismissed")})}):t.trigger("navViewDismissed")};t.app.views.isRenderred("system.NavView")?e(t.app.views.get("system.NavView").undelegateEvents().$el):t.trigger("navViewDismissed")},i=function(){var e=function(e){$(e).attr("renderred","false"),$(e).css("visibility")=="visible"?$("div#wrapper").animate({"margin-left":"0px"},function(){$(e).fadeOut(function(){t.trigger("menuViewDismissed")})}):t.trigger("menuViewDismissed")};t.app.views.isRenderred("system.MenuView")?e(t.app.views.get("system.MenuView").undelegateEvents().$el):t.trigger("menuViewDismissed")},s=function(){var e=function(e){$(e).attr("renderred","false"),$("nav#contact-right").hasClass("mm-opened")?($("nav#contact-right").removeClass("mm-opened"),setTimeout(function(){t.trigger("contactViewDismissed")},500)):($("nav#contact-right").hide(),$(e).hide(),t.trigger("contactViewDismissed"))};t.app.views.isRenderred("system.ContactRightView")?e(t.app.views.get("system.ContactRightView").undelegateEvents().$el):t.trigger("ContactViewDismissed")},o=function(){$("#main").slideUp(function(){t.trigger("mainViewDismissed")})};t.once("dismissBackendUI",function(){i()}),t.once("menuViewDismissed",function(){r(),s()}),t.once("navViewDismissed",function(){o()}),t.once("mainViewDismissed",function(){n()}),t.once("headerViewDismissed",function(){e()}),t.trigger("dismissBackendUI")}})}),"use strict",define("modules/system/main",["./router"],function(e){return openbiz.Module.extend({router:e})}),"use strict",define("modules/user/models/User",["../../me/models/Me"],function(e){return Backbone.Model.extend({url:null,defualts:{email:null,password:null,contact:{},account:{},roles:[]},initialize:function(){this.url=openbiz.apps.cubi.appUrl+"/users"},create:function(e,t){$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:this.url,data:JSON.stringify(e),complete:function(e,n){switch(e.status){case 201:t(!0,e.responseJSON);break;default:}}})},requestResetPassword:function(){},resetPasswordWithToken:function(e,t,n){},login:function(t,n,r){var i={username:t,password:n};$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:this.url+"/login",data:JSON.stringify(i),complete:function(t,n){switch(t.status){case 200:var i=new e;openbiz.session.me=i,openbiz.session.me.fetch({success:function(){r(!0,i)}});break;case 401:r(!1);default:}}})}})}),define("text!templates/user/dashboardView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#">Home</a></li><li><a href="#">Library</a></li><li class="active">Data</li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-8"><h1>i\'m Dashboard</h1></div><div class="col-lg-4"></div></div></div>'}),"use strict",define("modules/user/views/DashboardView",["text!templates/user/dashboardView.html","../models/User"],function(e,t){return openbiz.View.extend({app:"cubi",module:"user",name:"dashboardView",el:"#main",model:t,events:{},subviews:{},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),$(window).off("resize"),openbiz.ui.update($(this.el)),this}})}),define("text!templates/user/forgetPasswordView.html",[],function(){return'<div class="real-border"><div class="row"><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div></div></div><div class="container"><div class="row"><div class="col-lg-12"><div class="account-wall"><section class="align-lg-center"><div class="site-logo"></div><h1 class="login-title"><%= viewTitle %><small> <%= viewDescription %></small></h1></section><form id="form-forget-password" parsley-validate="parsley-validate" novalidate="novalidate" class="form-signin"><div class="well corner-flip"><p><%= pleaseInputEmail %></p><div class="flip"></div></div><section><div class="input-group"><div class="input-group-addon"><i class="fa fa-user"></i></div><input id="inputEmail" required="required" type="email" parsley-type="email" parsley-trigger="change" name="username" placeholder="<%= email %>" class="form-control"/></div></section><button id="sign-in" type="submit" class="btn btn-lg btn-theme-inverse btn-block btn-send-request"><%= sendRequest %>            </button><section class="clearfix">             <a href="#!/user/login" class="pull-right help go-to-login"><%= goToLogin %>                        </a></section></form><a href="#" class="footer-link"><%= copyright %></a></div></div></div></div>'}),"use strict",define("modules/user/views/ForgetPasswordView",["text!templates/user/forgetPasswordView.html","../models/User"],function(e,t){return openbiz.View.extend({app:"cubi",module:"user",name:"forgetPasswordView",el:"#main",model:t,events:{},validate:function(){var e=this;$(this.el).find("#form-forget-password").parsley("addListener",{onFormValidate:function(t,n,r){n.preventDefault(),t&&e.resetPassword(n)}})},resetPassword:function(e){e.preventDefault(),console.log("reset Password")},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){function t(){var t=$(e.el).outerHeight(),n=$(e.el).find(".account-wall").outerHeight(),r=(t-n)/2;r>30?$(e.el).find(".account-wall").css("margin-top",r-25):$(e.el).find(".account-wall").css("margin-top",30)}var e=this;$(this.el).html(this.template(this.locale)),this.validate(),setTimeout(t,50);var n;return $(window).on("resize",function(e){clearTimeout(n),n=setTimeout(t,50)}),$(this.el).find("#inputEmail").val($.cookie("username")),openbiz.ui.update($(this.el)),this}})}),define("text!templates/user/loginView.html",[],function(){return'<div class="real-border"><div class="row"><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div></div></div><div class="container"><div class="row"><div class="col-lg-12"><div class="account-wall"><section class="align-lg-center"><div class="site-logo"></div><h1 class="login-title"><%= viewTitle %><small> <%= viewDescription %></small></h1></section><form id="form-signin" parsley-validate="parsley-validate" novalidate="novalidate" class="form-signin"><section><div class="input-group"><div class="input-group-addon"><i class="fa fa-user"></i></div><input id="inputEmail" required="required" type="email" parsley-type="email" parsley-trigger="change" name="username" placeholder="<%= email %>" class="form-control"/></div><div class="input-group"><div class="input-group-addon"><i class="fa fa-key"></i></div><input id="inputPassword" required="required" type="password" name="password" placeholder="<%= password %>" class="form-control"/></div></section><button id="sign-in" type="submit" class="btn btn-lg btn-theme-inverse btn-block btn-sign-in"><%= signIn %></button><section class="clearfix"><div data-color="red" class="iCheck pull-left"><input name="remember" type="checkbox" checked="checked" parsley-group="remember"/><label><%= remember %></label></div><a href="#!/user/forget-password" class="pull-right help btn-forget-password"><%= forgetPassword %></a></section><span data-text="<%= or %>" class="or"></span><a href="#!/user/register" class="btn btn-lg btn-inverse btn-block btn-create-account"><%= createAccount %></a></form><a href="#" class="footer-link"><%= copyright %></a></div></div></div></div>'}),"use strict",define("modules/user/views/LoginView",["text!templates/user/loginView.html","../models/User"],function(e,t){return openbiz.View.extend({app:"cubi",module:"user",name:"loginView",el:"#main",model:t,events:{},validate:function(){var e=this;$(this.el).find("#form-signin").parsley("addListener",{onFormValidate:function(t,n,r){n.preventDefault(),t&&e.checkLogin(n)}})},checkLogin:function(e){e.preventDefault();var t=this;$(this.el).find(".btn-sign-in").attr("data-loading-text",this.locale.signing).tbButton("loading"),$(t.el).find("#inputPassword").closest(".input-group").removeClass("parsley-error").addClass("parsley-success"),$(this.el).animate({scrollTop:0},500),$(this.el).addClass("slideDown"),this.model.login($(this.el).find("#inputEmail").val(),$(this.el).find("#inputPassword").val(),function(e,n){$(t.el).find(".btn-sign-in").tbButton("reset"),e?($(t.el).find("input[name='remember']").is(":checked")?$.cookie("username",n.get("username")):$.removeCookie("username"),setTimeout(function(){$(t.el).removeClass("slideDown"),$(t.el).fadeOut(function(){Backbone.history.trigger("dismissUserUI",function(){Backbone.history.navigate("#!/backend/dashboard",{trigger:!0,replace:!0})})})},500)):setTimeout(function(){$(t.el).removeClass("slideDown"),$(t.el).find("#inputPassword").closest(".input-group").removeClass("parsley-success").addClass("parsley-error"),$(t.el).find("#inputPassword").attr("data-content",t.locale.validation.incorrectPassword).popover("show")},500)})},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){function t(){var t=$(e.el).outerHeight(),n=$(e.el).find(".account-wall").outerHeight(),r=(t-n)/2;r>30?$(e.el).find(".account-wall").css("margin-top",r-25):$(e.el).find(".account-wall").css("margin-top",30)}var e=this;$(this.el).html(this.template(this.locale)),$("#wrapper div#header").hide(),$("#wrapper div#nav").hide(),$("#wrapper div#menu").hide(),setTimeout(t,50);var n;return $(window).on("resize",function(e){clearTimeout(n),n=setTimeout(t,50)}),$(this.el).find("#inputEmail").val($.cookie("username")),this.validate(),openbiz.ui.update($(this.el)),this}})}),define("text!templates/user/registerView.html",[],function(){return'<div class="real-border"><div class="row"><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div><div class="col-xs-1"></div></div></div><div class="container"><div class="row"><div class="col-lg-12"><div class="account-wall"><section class="align-lg-center"><div class="site-logo"></div><h1 class="login-title"><%= viewTitle %><small> <%= viewDescription %></small></h1></section><form id="form-sign-up" parsley-validate="parsley-validate" novalidate="novalidate" class="form-signup">           <section class="login"><div class="input-group"><div class="input-group-addon"><i class="fa fa-user"></i></div><input id="inputEmail" required="required" type="email" parsley-type="email" name="username" placeholder="<%= email %>" parsley-remote-method="POST" parsley-remote-message="<%= validation.emailDuplicated %>" class="form-control"/></div><div class="input-group"><div class="input-group-addon"><i class="fa fa-key"></i></div><input id="inputPassword" required="required" type="password" parsley-mincheck="6" parsley-trigger="change" name="password" placeholder="<%= password %>" class="form-control"/></div><div class="input-group"><div class="input-group-addon"><i class="fa fa-key"></i></div><input id="inputRepeatPassword" required="required" type="password" parsley-mincheck="6" parsley-trigger="change" name="password-repeat" placeholder="<%= repeatPassword %>" parsley-equalto="#inputPassword" parsley-equalto-message="<%= validation.passwordNotMatch %>" class="form-control"/></div></section><section class="profile"><div class="input-group"><div class="input-group-addon"><i class="fa fa-heart">        </i></div><ul data-color="green" class="iCheck form-control"><li style="padding-bottom:0px" class="pull-left col-xs-6"><input type="radio" id="title-mr" name="title" value="Mr" parsley-trigger="ifClicked ifChanged" parsley-required="true" parsley-group="title"/><label style="margin-bottom:0px;"><%= titleMr %></label></li><li style="padding-bottom:0px" class="pull-left col-xs-6"><input type="radio" id="title-ms" name="title" value="Ms" parsley-trigger="ifClicked ifChanged" parsley-group="title"/><label style="margin-bottom:0px"><%= titleMs %>              </label></li></ul></div><div class="input-group"><div class="input-group-addon"><i class="fa fa-tags"></i></div><div><input id="inputFirstName" name="firstName" parsley-trigger="change" required="required" type="text" placeholder="<%= firstName %>" style="width:48%;padding-right:0px;" class="form-control pull-left"/><input id="inputLastName" name="lastName" parsley-trigger="change" required="required" type="text" placeholder="<%= lastName %>" style="width:48%;padding-left:0px;" class="form-control pull-left"/></div></div><div class="input-group"><div class="input-group-addon"><i class="fa fa-group"></i></div><input id="inputCompany" name="company" parsley-mincheck="2" parsley-trigger="change" required="required" type="text" placeholder="<%= company %>" class="form-control pull-left"/></div><div class="input-group"><div class="input-group-addon"><i class="fa fa-phone-square"></i></div><input id="inputMobileCountryCode" name="mobileCountryCode" required="required" placeholder="<%= phoneCountryCode %>" value="<%= phoneDefaultCountryCode %>" style="width:25%;padding-right:0px;" class="form-control pull-left"/><input id="inputMobileNumber" name="mobileNumber" required="required" type="tel" placeholder="<%= mobileNumber %>" style="width:71%" class="form-control pull-left"/></div></section><section class="clearfix"><div data-color="red" class="iCheck pull-left">               <input id="inputAgreement" name="agreement" required="required" type="checkbox" parsley-trigger="ifUnchecked ifChecked" parsley-group="agreement" parsley-required-message="<%= validation.needAgreement %>"/><label><%= agreeWith %> <a href="#"><%= termOfUse %></a></label></div></section><section><button type="submit" class="btn btn-lg btn-theme-inverse btn-block btn-sign-up"><%= createAccountButton %>            </button></section><section class="clearfix">             <a href="#!/user/login" class="pull-right help go-to-login"><%= goToLogin %>                        </a></section></form><a href="#" class="footer-link"><%= copyright %></a></div></div></div></div>'}),"use strict",define("modules/user/views/RegisterView",["text!templates/user/registerView.html","../models/User"],function(e,t){return openbiz.View.extend({app:"cubi",module:"user",name:"registerView",el:"#main",model:t,events:{},validate:function(){var e=this;$(this.el).find("#inputEmail").attr("parsley-remote",this.app.appUrl+"/users/check-unique"),$(this.el).find("#form-sign-up").parsley("addListener",{onFormValidate:function(t,n,r){t&&(n.preventDefault(),e.signUp.call(e,n))}})},signUp:function(e){e.preventDefault(),$(this.el).find(".btn-sign-up").attr("data-loading-text",this.locale.signing).tbButton("loading"),$(this.el).animate({scrollTop:0},500),$(this.el).addClass("slideDown");var t=this;if(this.locale.nameFormat[0]=="firstName")var n=$(this.el).find("#inputLastName").val()+$(this.el).find("#inputFirstName").val();else var n=$(this.el).find("#inputLastName").val()+$(this.el).find("#inputFirstName").val();var r={username:$(this.el).find("#inputEmail").val(),password:$(this.el).find("#inputPassword").val(),contact:{name:{firstName:$(this.el).find("#inputFirstName").val(),lastName:$(this.el).find("#inputLastName").val(),displayName:n},company:$(this.el).find("#inputCompany").val(),title:$(this.el).find('input:radio[name="title"]#title-mr').is(":checked")?"Mr.":"Ms.",emails:[{category:"Default",email:$(this.el).find("#inputEmail").val()}],phones:[{type:"mobile",category:"Default",countryCode:$(this.el).find("#inputMobileCountryCode").val(),number:$(this.el).find("#inputMobileNumber").val()}]}};this.model.create(r,function(e){t.model.login(r.username,r.password,function(e,n){$(t.el).find(".btn-sign-up").tbButton("reset"),setTimeout(function(){$(t.el).removeClass("slideDown")},500),e&&$(t.el).fadeOut(function(){Backbone.history.trigger("dismissUserUI",function(){Backbone.history.navigate("#!/backend/me/setup",{trigger:!0,replace:!0})})})})})},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){function t(){var t=$(e.el).outerHeight(),n=$(e.el).find(".account-wall").outerHeight(),r=(t-n)/2;r>30?$(e.el).find(".account-wall").css("margin-top",r-25):$(e.el).find(".account-wall").css("margin-top",30)}var e=this;$(this.el).html(this.template(this.locale)),this.localize(),this.validate(),setTimeout(t,50);var n;return $(window).on("resize",function(e){clearTimeout(n),n=setTimeout(t,50)}),openbiz.ui.update($(this.el)),this},localize:function(){var e={firstName:$(this.el).find("#inputFirstName"),lastName:$(this.el).find("#inputLastName")},t=e.firstName.parent();t.html("");for(var n in this.locale.nameFormat){var r=e[this.locale.nameFormat[n]];switch(parseInt(n)){case 0:r.css({"padding-left":"20px","padding-right":"0px"});break;case 1:r.css({"padding-left":"0px","padding-right":"20px"})}t.append(r)}}})}),"use strict",define("modules/user/router",["../system/views/LayoutView","../me/models/Me"],function(e,t){return openbiz.Router.extend({app:openbiz.apps.cubi?openbiz.apps.cubi:"cubi",me:null,routes:{"":"home","!/user/login":"login","!/user/register":"register","!/user/forget-password":"forgetPassword","!/backend/dashboard":"dashboard"},initialize:function(){openbiz.Router.prototype.initialize.call(this),this.me=new t},home:function(){this.me.fetch({success:function(){Backbone.history.navigate("#!/backend/dashboard",{trigger:!0,replace:!0})},error:function(){Backbone.history.navigate("#!/user/login",{trigger:!0,replace:!0})}})},dashboard:function(){if(typeof openbiz.session.me.get("account")=="undefined"){Backbone.history.navigate("#!/backend/me/setup",{trigger:!0,replace:!0});return}var e=this.app.views.get("system.LayoutView");e!=null&&e.hideLoading(),this.renderView("user.DashboardView")},forgetPassword:function(){this.renderView("user.ForgetPasswordView")},login:function(){this.renderView("user.LoginView")},register:function(){this.renderView("user.RegisterView")}})}),"use strict",define("modules/user/main",["./router"],function(e){return openbiz.Module.extend({router:e})}),define("text!templates/me/setupWizardView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#!/backend/dashboard"><%= breadcrumb.home %></a></li><li><a href="#!/backend/me/profile"><%= breadcrumb.myAccount %></a></li><li class="active"><%= viewName %></li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-12"><section role="form" parsley-validate="parsley-validate" novalidate="novalidate" class="panel wizard-form corner-flip"><header class="panel-heading"><h2><%= viewTitle %></h2><label style="background-color:#edece5" class="color">Welcome to setup your account</label></header><div class="panel-body"><div><p>How would you like to setup your account ?</p><ul data-color="red" class="choose-mode iCheck"><li><input type="radio" name="mode" value="create" parsley-trigger="ifClicked ifChanged" parsley-required="true" parsley-group="setup-mode"/><label>I want to create a new company account</label></li><li><input type="radio" name="mode" value="join" parsley-trigger="ifClicked ifChanged" parsley-group="setup-mode"/><label>I want to join a company account</label></li></ul></div><form role="form" parsley-validate="parsley-validate" novalidate="novalidate" class="form-create-company"><hr/><p>Please review below form to create a new company account</p><div class="form-group"><label>Company Name</label><input name="name" required="required" parsley-mincheck="3" type="text" placeholder="Company Name" parsley-remote-method="POST" parsley-remote-message="<%= validation.companyNotUnique %>" class="form-control"/></div><div class="form-group"><label>Phone Number</label><div style="height:34px;"><input name="phone-country-code" required="required" placeholder="<%= phoneCountryCode %>" value="<%= phoneDefaultCountryCode %>" style="width:19%;margin-right:1%;" class="form-control pull-left"/><input name="phone-area-code" required="required" placeholder="<%= phoneAreaCode %>" style="width:24%;margin-right:1%;" class="form-control pull-left"/><input name="phone-number" required="required" type="tel" placeholder="<%= phoneNumber %>" style="width:55%" class="form-control pull-left"/></div></div><div class="form-group"><label>Address</label><div style="height:34px;margin-bottom:5px;"><input name="address-country" parsley-mincheck="2" required="required" placeholder="<%= addressCountry %>" value="<%= addressDefaultCountry %>" style="width:32%;margin-right:1%;" class="form-control pull-left"/><input name="address-province" parsley-mincheck="2" required="required" placeholder="<%= addressProvince %>" style="width:33%;margin-right:1%;" class="form-control pull-left"/><input name="address-city" parsley-mincheck="2" required="required" placeholder="<%= addressCity %>" style="width:33%" class="form-control pull-left"/></div><div style="height:34px;"><input name="address-street" parsley-mincheck="6" required="required" placeholder="<%= addressStreet %>" style="width:74%;margin-right:1%;" class="form-control pull-left"/><input name="address-zipcode" required="required" parsley-type="digits" placeholder="<%= addressZipcode %>" style="width:25%" class="form-control pull-left"/></div></div><div class="form-group"><label>Website</label><input name="website" type="url" placeholder="http://www.yourcompany.com" class="form-control"/></div><button type="submit" class="hidden"></button></form><form role="form" parsley-validate="parsley-validate" novalidate="novalidate" class="form-join-company"><hr/><p>Please ask your company\'s administrator for the invitation code. Normally it will send to by email or SMS.</p><div class="form-group"><label>Company Invitation Code</label><input name="token" style="text-transform: uppercase" required="required" type="text" parsley-remote-method="POST" parsley-remote-message="<%= validation.tokenInvalid %>" parsley-required="true" placeholder="<%= invitationCodePlaceHolder %>" class="form-control"/></div><button type="submit" class="hidden"></button></form></div><footer class="panel-footer"><button type="submit" class="btn-next btn btn-theme">Next Step &nbsp;<i class="fa fa-angle-right"></i></button></footer></section></div></div></div>'}),"use strict",define("modules/account/models/Account",["require"],function(e){return Backbone.Model.extend({url:null,idAttribute:"_id",defualts:{users:[],apps:[],info:{}},installApps:function(e,t){$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:this.url+"/apps",data:JSON.stringify(e),complete:function(e,n){switch(e.status){case 201:openbiz.session.me.fetch(),t(!0);break;default:t(!1)}}})},constructor:function(){this.url=openbiz.apps.cubi.appUrl+"/account",Backbone.Model.apply(this,arguments)}})}),"use strict",define("modules/account/models/User",["require"],function(e){return Backbone.Model.extend({urlRoot:openbiz.apps.cubi.appUrl+"/account/users",idAttribute:"_id",defualts:{_id:null,user:{},role:null}})}),"use strict",define("modules/account/models/UserCollection",["./User"],function(e){return Backbone.Collection.extend({model:e,url:openbiz.apps.cubi.appUrl?openbiz.apps.cubi.appUrl+"/account/users":null})}),"use strict",define("modules/account/models/Invitation",["require"],function(e){return Backbone.Model.extend({urlRoot:openbiz.apps.cubi.appUrl+"/account/invitations",idAttribute:"_id",defualts:{expiredDate:null,data:{}},getDisplayExpiryDate:function(){var e=new Date(this.get("expiredDate"));return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()}})}),"use strict",define("modules/account/models/InvitationCollection",["./Invitation"],function(e){return Backbone.Collection.extend({model:e,url:openbiz.apps.cubi.appUrl?openbiz.apps.cubi.appUrl+"/account/invitations":null})}),"use strict",define("modules/me/views/SetupWizardView",["text!templates/me/setupWizardView.html","../models/Me","../../account/models/Account","../../account/models/User","../../account/models/UserCollection","../../account/models/Invitation","../../account/models/InvitationCollection"],function(e,t,n,r,i,s,o){return openbiz.View.extend({app:"cubi",module:"me",name:"setupWizardView",el:"#main",models:{me:new t,account:new n,user:new r,userCollection:new i,invitation:new s,invitationCollection:new o},modals:{},events:{"click .btn-next":"onFormSubmit","click .btn-test-join":"showAccountDetailView","click .btn-test-create":"showAppSelectorView","click .btn-test-invite":"showUserInvitationView","click .btn-invite-users":"showUserInvitationView","click .btn-add-user":"showAddUserView","click .btn-done":"gotoDashboard","ifChecked .choose-mode":"showJoinCompanyForm"},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),$(window).off("resize"),this.setupForm(),openbiz.ui.update($(this.el)),this},gotoDashboard:function(e){e.preventDefault(),this.undelegateEvents(),Backbone.history.navigate("#!/backend/dashboard",{trigger:!0,replace:!0})},showJoinCompanyForm:function(e){var t=this;$(this.el).find('button[type="submit"]').removeAttr("disabled").addClass("btn-theme"),$(t.el).find('.choose-mode input[value="create"]').is(":checked")?$(t.el).find(".form-join-company").slideUp(function(){$(t.el).find(".form-create-company").slideDown()}):$(t.el).find(".form-create-company").slideUp(function(){$(t.el).find(".form-join-company").slideDown()})},showAddUserView:function(e){var t=this;e.preventDefault(),$("body").modalmanager("loading"),this.app.require(["text!templates/me/userAddModalView.html"],function(e){var n=_.template(e),r=$(n(t.locale.addUserView));r.modal(),t.localizeAddUserForm(),openbiz.ui.update(r),r.find(".form-add-user section.login").slideDown(0),r.find(".form-add-user .user-add-mode").off("ifChecked"),r.find(".form-add-user .user-add-mode").on("ifChecked",function(e){t.switchUserAddMode.call(t,e)}),r.find(".form-add-user").find("#inputEmail").attr("parsley-remote",t.app.appUrl+"/users/check-unique"),r.find(".form-add-user").parsley(),r.find(".form-add-user").parsley("addListener",{onFormValidate:function(e,n,r){n&&n.preventDefault();if(e){if(t.locale.addUserView.nameFormat[0]=="firstName")var i=$(".form-add-user").find("#inputLastName").val()+$(".form-add-user").find("#inputFirstName").val();else var i=$(".form-add-user").find("#inputLastName").val()+$(".form-add-user").find("#inputFirstName").val();var s={mode:$('.form-add-user .user-add-mode input[value="invite-user"]').is(":checked")?"invite-user":"create-user",username:$(".form-add-user").find("#inputEmail").val(),password:$(".form-add-user").find("#inputPassword").val(),contact:{name:{firstName:$(".form-add-user").find("#inputFirstName").val(),lastName:$(".form-add-user").find("#inputLastName").val(),displayName:i},company:$(".form-add-user").find("#inputCompany").val(),title:$(".form-add-user").find('input:radio[name="title"]#title-mr').is(":checked")?"Mr.":"Ms.",emails:[{category:"Default",email:$(".form-add-user").find("#inputEmail").val()}],phones:[{type:"mobile",category:"Default",countryCode:$(".form-add-user").find("#inputMobileCountryCode").val(),number:$(".form-add-user").find("#inputMobileNumber").val()}]}};$('.form-add-user .user-add-mode input[value="invite-user"]').is(":checked")&&delete s.password,$(t.el).data("newUserData",s),t.showAddUserPermissionView(n)}}}),t.modals.addUserModal=r})},switchUserAddMode:function(e){var t=this;e.preventDefault(),$('.form-add-user .user-add-mode input[value="invite-user"]').is(":checked")?($(".form-add-user section.login").slideUp(),$(".form-add-user").parsley("removeItem","#inputPassword"),$(".form-add-user").parsley("removeItem","#inputRepeatPassword"),$(".form-add-user").find("#inputEmail").parsley("updateConstraint",{remote:t.app.appUrl+"/users/check-invitable"},t.locale.addUserView.validation.emailNotInvitable)):($(".form-add-user section.login").slideDown(),$(".form-add-user").parsley("addItem","#inputPassword"),$(".form-add-user").parsley("addItem","#inputRepeatPassword"),$(".form-add-user").find("#inputEmail").parsley("updateConstraint",{remote:t.app.appUrl+"/users/check-unique"},t.locale.addUserView.validation.emailDuplicated))},showAddUserPermissionView:function(e){var t=this;e.preventDefault();var n=$(".form-add-user button[type='submit']"),r=n.closest(".modal"),i=openbiz.ui.loader;n.removeClass("btn-panel-reload").addClass("disabled"),r.append(i),i.css("opacity",1).fadeIn(),this.app.require(["text!templates/me/userPermissionModalView.html"],function(e){setTimeout(function(){n.removeClass("disabled").addClass("btn-panel-reload");var i=_.template(e);r.off("hidden.bs.modal"),r.on("hidden.bs.modal",function(){t.locale.userPermissionView.user=$(t.el).data("newUserData"),t.locale.userPermissionView.apps=t.selectedApps;var e=$(i(t.locale.userPermissionView));e.modal(),e.find(".btn-add-permission-done").off("click"),e.find(".btn-add-permission-done").on("click",function(n){t.addUserSubmit.call(t,n,e)}),openbiz.ui.update(r)}),r.modal("hide")},500)})},addUserSubmit:function(e,t){var n=this;e.preventDefault();var r=[];$('.role-selection input[name="role"]').each(function(){$(this).is(":checked")&&r.push($(this).val())});var i=$(n.el).data("newUserData");i.roles=r;var s=function(){$(n.el).find(".btn-add-user").removeClass("btn-theme"),$(n.el).find(".btn-done").addClass("btn-theme").removeAttr("disabled")},o=$(".form-add-user button[type='submit']"),u=o.closest(".modal"),a=openbiz.ui.loader;o.removeClass("btn-panel-reload").addClass("disabled"),u.append(a),a.css("opacity",1).fadeIn(),setTimeout(function(){switch(i.mode){case"invite-user":n.models.invitationCollection.create(i,{success:function(){n.models.invitationCollection.fetch({success:function(){t.modal("hide"),s()}})}});break;case"create-user":n.models.userCollection.create(i,{success:function(){n.models.userCollection.fetch({success:function(){t.modal("hide"),s()}})}})}},500)},localizeAddUserForm:function(){var e={firstName:$(".form-add-user").find("#inputFirstName"),lastName:$(".form-add-user").find("#inputLastName")},t=e.firstName.parent();t.html("");for(var n in this.locale.addUserView.nameFormat){var r=e[this.locale.addUserView.nameFormat[n]];switch(parseInt(n)){case 0:r.css({"margin-right":"2%"});break;case 1:r.css({"margin-right":"0%"})}t.append(r)}},showAccountDetailView:function(e,t){var n=this;e&&e.preventDefault();var r=$(this.el).find("button.btn-next"),i=r.closest(".panel"),s=openbiz.ui.loader;r.removeClass("btn-panel-reload").addClass("disabled"),i.append(s),s.css("opacity",1).fadeIn(),this.app.require(["modules/system/models/AppCollection"],function(e){var o=new e;o.fetch({success:function(){n.app.require(["text!templates/me/setupWizardAccountDetailForm.html"],function(e){setTimeout(function(){r.removeClass("disabled").addClass("btn-panel-reload");var n=_.template(e);i.hide(),t.installedApps=o.toJSON(),i.replaceWith(n({data:t})),openbiz.ui.update(i),i.fadeIn(function(){i.find(s).fadeOut(function(){$(this).remove()})})},500)})}})})},showAppSelectorView:function(e){e&&e.preventDefault();var t=this,n=$(this.el).find(".btn-next"),r=n.closest(".panel"),i=openbiz.ui.loader;n.removeClass("btn-panel-reload").addClass("disabled"),r.append(i),i.css("opacity",1).fadeIn(),this.app.require(["modules/system/models/AppCollection"],function(e){var s=new e;s.fetch({success:function(){t.app.require(["text!templates/me/setupWizardAppSelectorForm.html"],function(e){setTimeout(function(){n.removeClass("disabled").addClass("btn-panel-reload");var o=_.template(e);r.hide(),t.locale.apps=s.toJSON(),t.systemApps=s.toJSON(),r.replaceWith(o(t.locale)),openbiz.ui.update(r),r.fadeIn(function(){r.find(i).fadeOut(function(){$(this).remove()})})},500)})}})})},showUserInvitationView:function(e){var t=this,n=function(){t.models.userCollection.models.length>1||t.models.invitationCollection.models.length>0?($(t.el).find(".btn-add-user").removeClass("btn-theme"),$(t.el).find(".btn-done").addClass("btn-theme").removeAttr("disabled")):($(t.el).find(".btn-add-user").addClass("btn-theme"),$(t.el).find(".btn-done").removeClass("btn-theme").attr("disabled","disabled"))};t.models.userCollection.off("sync"),t.models.userCollection.on("sync",function(e){var r=_.template($(t.el).find("#user-list-template").html()),i={me:openbiz.session.me.toJSON(),users:e.toJSON(),locale:{}};n(),$(t.el).find("#user-list").html(r(i)),$(t.el).find("#user-list .btn-delete-record").off("click"),$(t.el).find("#user-list .btn-delete-record").on("click",function(e){e.preventDefault();var n=$(this).attr("record-id");bootbox.confirm({title:"User delete confirmation",message:"<h2>"+t.models.userCollection.get(n).get("user").username+"</h2> <br/>                                     You are about to delete this user: <br/>                                     Are you sure?",callback:function(e){e&&t.models.userCollection.get(n).destroy({success:function(){t.models.userCollection.fetch()}})}})})}),t.models.invitationCollection.off("sync"),t.models.invitationCollection.on("sync",function(e){var r=_.template($(t.el).find("#invitation-list-template").html()),i={invitations:e.toJSON(),locale:{}};n(),$(t.el).find("#invitation-list").html(r(i)),$(t.el).find("#invitation-list .btn-delete-record").off("click"),$(t.el).find("#invitation-list .btn-delete-record").on("click",function(e){e.preventDefault();var n=$(this).attr("record-id");bootbox.confirm({title:"Invitation delete confirmation",message:"<h2>"+n+"</h2> <br/>                                     You are about to delete this Invitation: <br/>                                     Are you sure?",callback:function(e){e&&t.models.invitationCollection.get(n).destroy({success:function(){t.models.invitationCollection.fetch()}})}})})}),e&&e.preventDefault();var r=[];t.selectedApps=[],$(this.el).find('.app-selection input[name="app"]').each(function(){if($(this).is(":checked")){r.push($(this).val());for(var e in t.systemApps)if(t.systemApps[e].name==$(this).val()){t.selectedApps.push(t.systemApps[e]);break}}}),this.models.account.installApps(r,function(n){var r=$(t.el).find(e.currentTarget),i=r.closest(".panel"),s=openbiz.ui.loader;r.removeClass("btn-panel-reload").addClass("disabled"),i.append(s),s.css("opacity",1).fadeIn(),t.app.require(["text!templates/me/setupWizardUserInvitationForm.html"],function(e){setTimeout(function(){r.removeClass("disabled").addClass("btn-panel-reload"),i.hide();var n=_.template($("<div>"+e+"</div>").find("#user-invitation-layout-template").html()),o=n({});o=$(o).append($("<div>"+e+"</div>").find("#user-list-template")),o=$(o).append($("<div>"+e+"</div>").find("#invitation-list-template")),i.replaceWith(o),openbiz.ui.update(i),i.fadeIn(function(){t.models.invitationCollection.fetch(),t.models.userCollection.fetch(),i.find(s).fadeOut(function(){$(this).remove()})})},500)})})},setupForm:function(){var e=this;$(this.el).find('button[type="submit"]').attr("disabled","disabled").removeClass("btn-theme"),$(this.el).find('.form-join-company input[name="token"]').attr("parsley-remote",this.app.appUrl+"/account/check-invitation-token"),$(this.el).find('.form-create-company input[name="name"]').val(openbiz.session.me.get("contact").company).attr("parsley-remote",this.app.appUrl+"/account/check-unique"),$(this.el).find(".form-join-company").slideUp(0).parsley("addListener",{onFormValidate:function(t,n,r){t&&e.onJoinAccount.call(e,n)}}),$(this.el).find(".form-create-company").slideUp(0).parsley("addListener",{onFormValidate:function(t,n,r){t&&e.onCreateAccount.call(e,n)}})},onFormSubmit:function(e){e.preventDefault(),$(this.el).find('.choose-mode input[value="create"]').is(":checked")?$(this.el).find(".form-create-company").parsley("validate"):$(this.el).find(".form-join-company").parsley("validate")},onJoinAccount:function(e){var t=$(this.el).find('input[name="token"]').val().toUpperCase(),n=this;this.models.me.joinAccount(t,function(t,r){console.log(t),console.log(r),t==1&&n.showAccountDetailView(e)})},onCreateAccount:function(e){var t={name:$(this.el).find('input[name="name"]').val(),info:{website:$(this.el).find('input[name="website"]').val(),address:{country:$(this.el).find('input[name="address-country"]').val(),province:$(this.el).find('input[name="address-province"]').val(),city:$(this.el).find('input[name="address-city"]').val(),street:$(this.el).find('input[name="address-street"]').val(),zipcode:$(this.el).find('input[name="address-zipcode"]').val()},phone:{countryCode:$(this.el).find('input[name="phone-country-code"]').val(),areaCode:$(this.el).find('input[name="phone-area-code"]').val(),number:$(this.el).find('input[name="phone-number"]').val()}}},n=this;this.models.me.createAccount(t,function(t){t==1&&n.showAppSelectorView(e)})}})}),"use strict",define("modules/me/router",["./models/Me"],function(e){return openbiz.Router.extend({app:openbiz.apps.cubi?openbiz.apps.cubi:"cubi",me:null,views:{},routes:{"do-nothing":"doNothing","!/backend/me/logout":"logout","!/backend/me/profile":"logout","!/backend/me/setup":"setupWizard"},initialize:function(){openbiz.Router.prototype.initialize.call(this),this.me=new e},doNothing:function(){},setupWizard:function(){this.renderView("me.SetupWizardView")},logout:function(){var e=this;Backbone.history.trigger("dismissBackendUI",function(){openbiz.session.me.on("destroy",function(){location.href="#!/user/login",setTimeout(function(){_.each(openbiz.apps,function(e){e.views.reset()})},1e3)}),openbiz.session.me.destroy()})}})}),"use strict",define("modules/me/main",["./router"],function(e){return openbiz.Module.extend({router:e})}),define("text!templates/account/applicationsView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#">Home</a></li><li><a href="#">Account</a></li><li class="active">Applications</li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-12">   </div></div></div>'}),"use strict",define("modules/account/views/ApplicationsView",["text!templates/account/applicationsView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"account",name:"applicationsView",el:"#main",events:{},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),$(window).off("resize"),openbiz.ui.update($(this.el)),this}})}),define("text!templates/account/membersView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#">Home</a></li><li><a href="#">Account</a></li><li class="active">Members</li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-12">   </div></div></div>'}),"use strict",define("modules/account/views/MembersView",["text!templates/account/membersView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"account",name:"membersView",el:"#main",events:{},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),$(window).off("resize"),openbiz.ui.update($(this.el)),this}})}),define("text!templates/account/invitationsListView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#!/backend/dashboard">Home</a></li><li><a href="#!/backend/account">Account</a></li><li class="active">Invitations</li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-12">   <section role="form" parsley-validate="parsley-validate" novalidate="novalidate" class="panel wizard-form corner-flip"><header class="panel-heading"><h2>User Invitations</h2><p>You can invite your colleague to join this account  </p></header><div class="panel-body"><table class="table table-striped table-bordered text-center"><thead><tr><th>Token</th><th class="hidden-xs">Invited User</th><th>Email</th><th class="hidden-xs">Expiry Date                            </th><th>Action</th></tr></thead><tbody> \n<% if(invitations.length){ %>      \n<% _.forEach(invitations,function(invitation){ %>        <tr><td><a href="#!/backend/account/invitations/<%= invitation.id %>"><%= invitation.id %></a></td><td class="hidden-xs"><%= invitation.get(\'data\').contact.name.displayName %></td><td><%= invitation.get(\'data\').username %></td><td class="hidden-xs"><%= invitation.getDisplayExpiryDate() %>                            </td><td><div class="tooltip-area"><a href="#!/backend/account/invitations/<%= invitation.id %>" style="margin-right:5px;" class="btn btn-default btn-sm btn-record-detail"><span class="hidden-xs"><i class="fa fa-file-text-o"></i>&nbsp; Detail &nbsp;</span><span class="visible-xs"><i class="fa fa-file-text-o"></i></span></a><a href="#" record-id="<%= invitation.id %>" class="btn btn-default btn-sm btn-record-delete"><span class="hidden-xs"><i class="fa fa-trash-o"></i>&nbsp; Delete &nbsp;</span><span class="visible-xs"><i class="fa fa-trash-o"></i></span></a></div></td></tr><% }) %>\n<% }else{ %><tr><td colspan="5">Please click "Invite User" button to start invite your colleagues.</td></tr><% } %></tbody></table></div><footer class="panel-footer"><button type="submit" class="btn-next btn btn-theme btn-record-add"><i class="fa fa-plus"></i>&nbsp; Invite User &nbsp;                    </button></footer></section></div></div></div>'}),"use strict",define("modules/account/views/InvitationsListView",["text!templates/account/invitationsListView.html","../models/InvitationCollection"],function(e,t){return openbiz.View.extend({app:"cubi",module:"account",name:"invitationsListView",el:"#main",collection:t,events:{"click .btn-record-delete":"showRecordDeleteConfirm","click .btn-record-add":"showRecordAddView"},initialize:function(){var n=this;openbiz.View.prototype.initialize.call(this),this.template=_.template(e),this.collection=new t,this.collection.on("sync",function(){var e=n.locale;e.invitations=n.collection.models,$(n.el).html(n.template(e)),openbiz.ui.update($(n.el))})},render:function(){return $(window).off("resize"),this.collection.fetch(),this},showRecordAddView:function(e){e.preventDefault(),this.popupView("account.InvitationsNewView")},showRecordDeleteConfirm:function(e){e.preventDefault();var t=this,n=$(e.currentTarget).attr("record-id");bootbox.confirm({title:"Data delete confirmation",message:"<h2>"+n+"</h2> <br/> 	    				You are about to delete this invitation: <br/> 	    				Are you sure?",callback:function(e){e&&t.collection.get(n).destroy({success:function(){t.collection.fetch()}})}})}})}),define("text!templates/account/invitationsNewView.html",[],function(){return'<div id="user-add-model" tabindex="-1" class="modal fade"><div class="modal-header"><button type="button" data-dismiss="modal" aria-hidden="true" class="close">×</button><h3>Add a New User</h3></div><form role="form" parsley-validate="parsley-validate" novalidate="novalidate" class="modal-body form-add-user">       <section class="profile"><div class="form-group"><label style="display:block;margin-right:20px;padding-top:5px;" class="pull-left">Title</label><div style="border:none;height:30px"><ul data-color="green" style="width:200px;" class="iCheck pull-left"><li style="padding-bottom:0px" class="pull-left col-xs-6"><input type="radio" id="title-mr" name="title" value="Mr" parsley-trigger="ifClicked ifChanged" parsley-required="true" parsley-group="title"/><label style="margin-bottom:0px;"><%= titleMr %></label></li><li style="padding-bottom:0px" class="pull-left col-xs-6"><input type="radio" id="title-ms" name="title" value="Ms" parsley-trigger="ifClicked ifChanged" parsley-group="title"/><label style="margin-bottom:0px"><%= titleMs %></label></li></ul></div></div><div class="form-group"><label>Name</label><div style="height:34px;"><input id="inputFirstName" name="firstName" parsley-trigger="change" required="required" type="text" placeholder="<%= firstName %>" style="width:49%;margin-right:2%" class="form-control pull-left"/><input id="inputLastName" name="lastName" parsley-trigger="change" required="required" type="text" placeholder="<%= lastName %>" style="width:49%;0px;" class="form-control pull-left"/></div></div><div class="form-group"><label>Mobile</label><div style="height:34px;"><input id="inputMobileCountryCode" name="mobileCountryCode" required="required" placeholder="<%= phoneCountryCode %>" value="<%= phoneDefaultCountryCode %>" style="width:25%;padding-right:0px;margin-right:2%" class="form-control pull-left"/><input id="inputMobileNumber" name="mobileNumber" required="required" type="tel" placeholder="<%= mobileNumber %>" style="width:73%" class="form-control pull-left"/></div></div><div class="form-group"><label>Email</label><input id="inputEmail" required="required" type="email" parsley-type="email" name="username" placeholder="<%= email %>" parsley-remote-method="POST" parsley-remote-message="<%= validation.emailDuplicated %>" class="form-control"/></div></section><section><hr/><button style="margin-right:10px;" type="submit" class="btn-add-user-done btn button btn-theme">&nbsp; Next &nbsp;<i class="fa fa-angle-right"></i></button></section></form></div>'}),"use strict",define("modules/account/views/InvitationsNewView",["text!templates/account/invitationsNewView.html","../models/Invitation"],function(e,t){return openbiz.View.extend({app:"cubi",module:"account",name:"invitationsNewView",el:"",model:t,events:{},initialize:function(){this.model=new t,this.template=_.template(e),openbiz.View.prototype.initialize.call(this)},render:function(){var e=this,t=e.locale;return this.$el=$(e.template(t)),this._localizeAddUserForm(),openbiz.ui.update(this.$el),this},_localizeAddUserForm:function(){var e={firstName:$(".form-add-user").find("#inputFirstName"),lastName:$(".form-add-user").find("#inputLastName")},t=e.firstName.parent();t.html("");for(var n in this.locale.nameFormat){var r=e[this.locale.nameFormat[n]];switch(parseInt(n)){case 0:r.css({"margin-right":"2%"});break;case 1:r.css({"margin-right":"0%"})}t.append(r)}}})}),define("text!templates/account/invitationsDetailView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#!/backend/dashboard">Home</a></li><li><a href="#!/backend/account">Account</a></li><li><a href="#!/backend/account/invitations">Invitations</a></li><li class="active"><%= data.id %></li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-12">   <section role="form" parsley-validate="parsley-validate" novalidate="novalidate" class="panel wizard-form corner-flip"><header class="panel-heading"><h3>User Invitations</h3><h2><%= data.id %></h2></header><div class="panel-body"><form data-alignlabel="left" data-collabel="3" class="form-horizontal">               <div class="col-lg-6 col-md-6 col-sm-6"><div class="divider"><h4>Details</h4></div><div class="form-group"><label class="col-xs-3"><i class="fa fa-tags"></i><span>&nbsp; Name</span></label><div class="col-xs-9"><%= data.get(\'data\').contact.name.displayName %>                  </div></div><div class="form-group"><label class="col-xs-3"><i class="fa fa-user"></i><span>&nbsp; Email</span></label><div class="col-xs-9"><%= data.get(\'data\').username %></div></div><div class="form-group"><label class="col-xs-3"><i class="fa fa-phone-square"></i><span>&nbsp; Mobile</span></label><div class="col-xs-9"><%= data.get(\'data\').contact.phones[0].countryCode %> <%= data.get(\'data\').contact.phones[0].number %></div></div><div class="form-group"><label class="col-xs-3"><i class="fa fa-calendar-o"></i><span>&nbsp; Expiry</span></label><div class="col-xs-9"><%= data.getDisplayExpiryDate() %></div></div></div><div class="col-lg-6 col-md-6 col-sm-6"><div style="margin-bottom:5px" class="divider"><h4>Roles</h4></div><div><% _.forEach(installedApps,function(app){  app = app.toJSON(); %><div><label><%= app.info.name %>   </label></div><ul style="margin-bottom:10px"><% _.forEach(app.roles,function(role){ if(data.get(\'data\').roles.indexOf(role.id)!=-1){ %><li style="margin-bottom:5px"><span style="margin-right:5px" class="glyphicon glyphicon-user"></span><span><%= role.name %>    </span></li><% }}) %>               </ul><% }) %></div></div></form></div><footer class="panel-footer"><a style="margin-right:5px;" href="#!/backend/account/invitations" class="btn-next btn btn-theme btn-record-back"><i class="fa fa-list-ul"></i>&nbsp; Back to list &nbsp;</a><button record-id="<%= data.id %>" class="btn-next btn btn-record-delete"><i class="fa fa-trash-o"></i>&nbsp; Delete &nbsp;</button></footer></section></div></div></div>'}),"use strict",define("modules/account/views/InvitationsDetailView",["text!templates/account/invitationsDetailView.html","../models/Invitation"],function(e,t){return openbiz.View.extend({app:"cubi",module:"account",name:"invitationsDetailView",el:"#main",model:t,events:{"click .btn-record-delete":"showRecordDeleteConfirm"},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(e){var n=this;return $(window).off("resize"),this.model=new t({_id:e}),this.model.fetch({success:function(){n.app.require(["modules/system/models/AppCollection"],function(e){var t=new e;t.fetch({success:function(){var e=n.locale;e.data=n.model,e.installedApps=t.models,console.log(e),$(n.el).html(n.template(e)),openbiz.ui.update($(n.el))}})})}}),this},showRecordDeleteConfirm:function(e){e.preventDefault();var t=this,n=$(e.currentTarget).attr("record-id");bootbox.confirm({title:"Data delete confirmation",message:"<h2>"+n+"</h2> <br/> 	    				You are about to delete this invitation: <br/> 	    				Are you sure?",callback:function(e){e&&t.collection.get(n).destroy({success:function(){t.collection.fetch()}})}})}})}),define("text!templates/account/profileView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#">Home</a></li><li><a href="#">Account</a></li><li class="active">Profile</li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-12">   </div></div></div>'}),"use strict",define("modules/account/views/ProfileView",["text!templates/account/profileView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"account",name:"profileView",el:"#main",events:{},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),$(window).off("resize"),openbiz.ui.update($(this.el)),this}})}),define("text!templates/account/billingView.html",[],function(){return'<ol class="breadcrumb"><li><a href="#">Home</a></li><li><a href="#">Account</a></li><li class="active">Billing</li></ol><!-- //breadcrumb--><div id="content"><div class="row"><div class="col-lg-12">   </div></div></div>'}),"use strict",define("modules/account/views/BillingView",["text!templates/account/billingView.html"],function(e){return openbiz.View.extend({app:"cubi",module:"account",name:"billingView",el:"#main",events:{},initialize:function(){openbiz.View.prototype.initialize.call(this),this.template=_.template(e)},render:function(){return $(this.el).html(this.template(this.locale)),$(window).off("resize"),openbiz.ui.update($(this.el)),this}})}),"use strict",define("modules/account/router",[],function(){return openbiz.Router.extend({app:openbiz.apps.cubi?openbiz.apps.cubi:"cubi",views:{},routes:{"!/backend/account/applications":"showApplications","!/backend/account/members":"showMembers","!/backend/account/invitations":"showInvitations","!/backend/account/invitations/:id":"showInvitationDetail","!/backend/account/profile":"showProfile","!/backend/account/billing":"showBilling"},initialize:function(){openbiz.Router.prototype.initialize.call(this)},showApplications:function(){this.renderView("account.ApplicationsListView")},showInvitations:function(){this.renderView("account.InvitationsListView")},showInvitationDetail:function(e){this.renderView("account.InvitationsDetailView",arguments)},showMembers:function(){this.renderView("account.MembersListView")},showProfile:function(){this.renderView("account.ProfileListView")},showBilling:function(){this.renderView("account.BillingListView")}})}),"use strict",define("modules/account/main",["./router"],function(e){return openbiz.Module.extend({router:e})}),define("text!templates/menu/accountMenuView.html",[],function(){return'<li class="app-menu"><span><i class="icon fa fa-group"></i>Account</span><ul><li><a href="#!/backend/account/applications"> Applications </a></li><li><a href="#!/backend/account/members"> Members</a></li><li><a href="#!/backend/account/invitations"> Invitations</a></li><li><a href="#!/backend/account/profile"> Profile</a></li><li><a href="#!/backend/account/billing"> Billing</a></li></ul></li>'}),"use strict",define("menu/main",["text!templates/menu/accountMenuView.html"],function(e){return openbiz.Menu.extend({app:"cubi",el:"nav#menu ul.system-menu",menu:"account-menu",menuRoot:"nav#menu",initialize:function(){openbiz.Menu.prototype.initialize.call(this),this.template=_.template(e)},render:function(){var e=this;if(openbiz.session.me.hasPermission("cubi-account-manage")){var t=this.template(this.locale);this.updateMenu(t)}return this}})}),"use strict",define("main",["i18n!./nls/locale","./modules/system/main","./modules/user/main","./modules/me/main","./modules/account/main","./menu/main"],function(e,t,n,r,i,s){return openbiz.Application.extend({name:"cubi",appUrl:REPLACE_APPURL,baseUrl:REPLACE_BASEURL,modules:{system:t,user:n,me:r,account:i},init:function(){for(var e in this.modules)this.modules[e].init()},locale:e,menu:s})});